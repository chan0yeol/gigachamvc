<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.giga.gw.repository.AttendanceDaoImpl">
    <!-- 근무 테이블 만들기  -->
<insert id="createattendacetable">
	INSERT INTO ATTENDANCERECORD (
    ATTNO, EMPNO, WORK_DATE, WORKIN_TIME, WORKOUT_TIME, WORK_TIME, WORK_STATUS, USE_YN
)
SELECT 
    TO_CHAR(CURRENT_DATE , 'YYMMDD') || LPAD(ATTNO_SEQ.NEXTVAL, 3, '0'), -- SEQUENCE 사용
    E.EMPNO,
    TRUNC(CURRENT_DATE),
    '',
    '',
    '',
    '',
    'Y'
FROM EMPLOYEES E
LEFT JOIN ATTENDANCERECORD A 
    ON E.EMPNO = A.EMPNO 
    AND A.WORK_DATE = TRUNC(CURRENT_DATE)
WHERE A.EMPNO IS NULL
</insert>

<!--연차 가져오기-->
<select id="leaveList" resultType="map">
   		SELECT t1.EMPNO, t2.NAME,
    		START_DATE ,  END_DATE  
			FROM APPROVAL t1
			JOIN EMPLOYEES t2 ON t1.EMPNO = t2.EMPNO
			WHERE CURRENT_DATE BETWEEN START_DATE AND END_DATE 
			AND APPROVAL_STATUS = 'ST04'
			AND FORM_ID LIKE 'BC%'
</select>



</mapper>
